<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction to hiaR • hiaR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to hiaR">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">hiaR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/hiaR.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/reference_data.html">Create reference data</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/citation.html">Citation</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Dynamo-HIA/hiaR"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Introduction to hiaR</h1>
            
      

      <div class="d-none name"><code>hiaR.Rmd</code></div>
    </div>

    
    
<p>This introduction shows how to use the <code>hiaR</code> package in a
simple example. The <code>hiaR</code> package is a wrapper for a Java
application which implements the DYNAMO-HIA model. For details on the
DYNAMO-HIA model, see the <a href="https://dynamo-hia.github.io/" class="external-link">DYNAMO-HIA documentation</a>. The
DYNAMO-HIA model simulates the health impact of interventions on risk
factors on disease outcomes and life expectancy in a population. In this
example, we simulate the effect of an intervention on smoking on the
development of lung cancer in the Dutch population.</p>
<p>We start by loading the <code>hiar</code> package:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dynamo-hia.github.io/hiaR/">hiaR</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="reference-data">Reference data<a class="anchor" aria-label="anchor" href="#reference-data"></a>
</h2>
<p>To run simulations, the DYNAMO-HIA model requires reference data. The
reference data for the Netherlands is included in the package. We move
the reference data into a temporary local directory using the <a href="https://withr.r-lib.org/" class="external-link"><code>withr</code></a> package:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create local temporary directory; the directory will be deleted when the R session is finished</span></span>
<span><span class="va">temp_dir</span> <span class="op">&lt;-</span> <span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_tempfile.html" class="external-link">local_tempdir</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/copy.html" class="external-link">dir_copy</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"example-nl"</span>, package <span class="op">=</span> <span class="st">"hiaR"</span><span class="op">)</span>, <span class="va">temp_dir</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>The <code>Reference_Data</code> folder in our directory now contains
the reference data for the Netherlands including information about the
Dutch population, diseases, and risk factors. These will be used mainly
as the <em>reference scenario</em> in the simulations. We can get an
overview of the available populations, diseases, and risk factors with
helper functions from the <code>hiaR</code> package:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define path to reference data</span></span>
<span><span class="va">reference_data_path</span> <span class="op">&lt;-</span> <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/path.html" class="external-link">path</a></span><span class="op">(</span><span class="va">temp_dir</span>, <span class="st">"Reference_Data"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Available diseases:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Available diseases:</span></span>
<span><span class="va">disease_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_disease_names.html">get_disease_names</a></span><span class="op">(</span><span class="va">reference_data_path</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB; font-weight: bold;">C:/Users/RUNNER~1/AppData/Local/Temp/RtmpoRI94J/file15f8b036025/Reference_Data/Diseases</span></span></span>
<span><span class="co">#&gt; └── <span style="color: #0000BB; font-weight: bold;">Lung_Cancer</span></span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nAvailable populations:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Available populations:</span></span>
<span><span class="va">population_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_population_names.html">get_population_names</a></span><span class="op">(</span><span class="va">reference_data_path</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB; font-weight: bold;">C:/Users/RUNNER~1/AppData/Local/Temp/RtmpoRI94J/file15f8b036025/Reference_Data/Populations</span></span></span>
<span><span class="co">#&gt; └── <span style="color: #0000BB; font-weight: bold;">Netherlands</span></span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nAvailable risk factors:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Available risk factors:</span></span>
<span><span class="va">risk_factor_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_risk_factor_names.html">get_risk_factor_names</a></span><span class="op">(</span><span class="va">reference_data_path</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB; font-weight: bold;">C:/Users/RUNNER~1/AppData/Local/Temp/RtmpoRI94J/file15f8b036025/Reference_Data/Risk_Factors</span></span></span>
<span><span class="co">#&gt; └── <span style="color: #0000BB; font-weight: bold;">Smoking_cat3</span></span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="configuration">Configuration<a class="anchor" aria-label="anchor" href="#configuration"></a>
</h2>
<p>We will now configure a simulation to assess the effect of the risk
factor smoking on the health of the Dutch population. We will use a risk
factor configuration with three categories (never smoked, former smoker,
current smoker). To configure the risk factor, we need to provide a
unique name, the name of the file with the risk factor transition type,
and the name of the file with the risk factor prevalence. We can get the
names of the files from the reference data with the
<code>get_risk_factor_filenames</code> function:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_risk_factor_filenames.html">get_risk_factor_filenames</a></span><span class="op">(</span><span class="va">reference_data_path</span>, <span class="st">"Smoking_cat3"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB; font-weight: bold;">C:/Users/RUNNER~1/AppData/Local/Temp/RtmpoRI94J/file15f8b036025/Reference_Data/Risk_Factors/Smoking_cat3</span></span></span>
<span><span class="co">#&gt; ├── configuration.xml</span></span>
<span><span class="co">#&gt; ├── <span style="color: #0000BB; font-weight: bold;">Prevalences</span></span></span>
<span><span class="co">#&gt; │   ├── NL_RF_smoking_cat3_Prev_V1.xml</span></span>
<span><span class="co">#&gt; │   └── RF_smoking_cat_All_Never_Smokers_Prev.xml</span></span>
<span><span class="co">#&gt; ├── <span style="color: #0000BB; font-weight: bold;">Relative_Risks_For_Death</span></span></span>
<span><span class="co">#&gt; │   └── RR_smoking_cat3_to_TotalMort.xml</span></span>
<span><span class="co">#&gt; └── <span style="color: #0000BB; font-weight: bold;">Transitions</span></span></span>
<span><span class="co">#&gt;     ├── NL_RF_smoking_Transitions_Netto.xml</span></span>
<span><span class="co">#&gt;     └── NL_RF_smoking_Transitions_Zero.xml</span></span></code></pre></div>
<p>The files in the different sub directories are briefly described here
(for details, see the <a href="https://dynamo-hia.github.io/" class="external-link">DYNAMO-HIA
documentation</a>):</p>
<ul>
<li>
<code>Prevalence</code>: Files with data on which part of the
population is in which risk factor category (split by age and
gender)</li>
<li>
<code>Relative_Risks_For_Death</code>: Files with the relative risks
for death for each risk factor category (split by age and gender)</li>
<li>
<code>Relative_Risks_For_Disability</code> Files with the relative
risks for disability for each risk factor category (split by age and
gender)</li>
<li>
<code>Transitions</code>: Files with the transition probabilities
between the risk factor categories</li>
</ul>
<p>With the file names we can configure the risk factor:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">smoking_config</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/configure_risk_factor.html">configure_risk_factor</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"Smoking_cat3"</span>, <span class="co"># Should be the same as the name in the reference data</span></span>
<span>  transition_filename <span class="op">=</span> <span class="st">"NL_RF_smoking_Transitions_Netto"</span>,</span>
<span>  prevalence_filename <span class="op">=</span> <span class="st">"NL_RF_smoking_cat3_Prev_V1"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We chose a “Netto” transition file which indicates that the risk
factor prevalence for each age and gender group will remain the same
during the simulation.</p>
<p>The DYNAMO-HIA model also takes different diseases within the
population into account. While the reference data provides information
about several diseases we will only look at lung cancer in this example.
The disease configuration requires a unique name for the disease, names
of files with the disease prevalence, incidence, excess mortality, and
disability weights. We can get the names of the files from the reference
data with the <code>get_disease_filenames</code> function:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_disease_filenames.html">get_disease_filenames</a></span><span class="op">(</span><span class="va">reference_data_path</span>, <span class="st">"Lung_Cancer"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB; font-weight: bold;">C:/Users/RUNNER~1/AppData/Local/Temp/RtmpoRI94J/file15f8b036025/Reference_Data/Diseases/Lung_Cancer</span></span></span>
<span><span class="co">#&gt; ├── <span style="color: #0000BB; font-weight: bold;">Disability</span></span></span>
<span><span class="co">#&gt; │   └── NL_disease_LungCa_DALY_V1.xml</span></span>
<span><span class="co">#&gt; ├── <span style="color: #0000BB; font-weight: bold;">Excess_Mortalities</span></span></span>
<span><span class="co">#&gt; │   └── NL_disease_LungCa_ExecMor_V2.xml</span></span>
<span><span class="co">#&gt; ├── <span style="color: #0000BB; font-weight: bold;">Incidences</span></span></span>
<span><span class="co">#&gt; │   └── NL_disease_LungCa_Inc_V2.xml</span></span>
<span><span class="co">#&gt; ├── <span style="color: #0000BB; font-weight: bold;">Prevalences</span></span></span>
<span><span class="co">#&gt; │   └── NL_disease_LungCa_Prev_V2.xml</span></span>
<span><span class="co">#&gt; └── <span style="color: #0000BB; font-weight: bold;">Relative_Risks_From_Risk_Factor</span></span></span>
<span><span class="co">#&gt;     ├── RR_to_LungCa-Alcohol_cat5.xml</span></span>
<span><span class="co">#&gt;     ├── RR_to_LungCa-Smoking_cat3.xml</span></span>
<span><span class="co">#&gt;     ├── RR_to_LungCa-Smoking_dur.xml</span></span>
<span><span class="co">#&gt;     ├── RR_to_LungCa_V2-BMI_cat3.xml</span></span>
<span><span class="co">#&gt;     └── RR_to_LungCa_V2-BMI_cont.xml</span></span></code></pre></div>
<p>A brief description of the sub directories:</p>
<ul>
<li>
<code>Disability</code>: Files with the disability
(disability-adjusted life years) weights for the disease (split by age
and gender)</li>
<li>
<code>Excess_Mortalities</code>: Files with the additional mortality
when carrying the disease (split by age and gender)</li>
<li>
<code>Incidence</code>: Files with the incidence of the disease
(split by age and gender)</li>
<li>
<code>Prevalence</code>: Files with the prevalence of the disease
(split by age and gender)</li>
<li>
<code>Relative_Risks_From_Diseases</code>: Files with the relative
risks of carrying the disease when having another disease (split by age
and gender; not used in this example)</li>
<li>
<code>Relative_Risks_From_Risk_Factor</code>: Files with the
relative risks of carrying the disease when being exposed to a risk
factor (split by age and gender)</li>
</ul>
<p>With the file names we can configure the disease:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lung_cancer_config</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/configure_disease.html">configure_disease</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"Lung_Cancer"</span>,</span>
<span>  prevalence_filename <span class="op">=</span> <span class="st">"NL_disease_LungCa_Prev_V2"</span>,</span>
<span>  incidence_filename <span class="op">=</span> <span class="st">"NL_disease_LungCa_Inc_V2"</span>,</span>
<span>  excess_mortality_filename <span class="op">=</span> <span class="st">"NL_disease_LungCa_ExecMor_V2"</span>,</span>
<span>  disability_weights_filename <span class="op">=</span> <span class="st">"NL_disease_LungCa_DALY_V1"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We can also configure a relative risk of having lung cancer due to
smoking. The relative risk configuration requires an index, the name of
the risk factor, the name of the disease, and the name of the file with
the relative risk data:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lung_cancer_smoking_rr_config</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/configure_relative_risk.html">configure_relative_risk</a></span><span class="op">(</span></span>
<span>  index <span class="op">=</span> <span class="fl">0</span>, <span class="co"># Start with zero</span></span>
<span>  from <span class="op">=</span> <span class="st">"Smoking_cat3"</span>,</span>
<span>  to <span class="op">=</span> <span class="st">"Lung_Cancer"</span>,</span>
<span>  relative_risk_filename <span class="op">=</span> <span class="st">"RR_to_LungCa-Smoking_cat3"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Besides risk factors and diseases, we also need to configure the
intervention scenario that we want to simulate. Scenarios require a
unique name, a success rate for an intervention, the minimum and maximum
age as well as the targeted gender for the intervention. Most
importantly, they need names of files with the transition type and
prevalence of the risk factor which is changed due to the
intervention.</p>
<p>We create a scenario that intervenes on the risk factor smoking and
assumes that the targeted population never smoked. We choose this
intervention by specifying a prevalence file that only contains “never
smokers”.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">smoking_intervention</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/configure_scenario.html">configure_scenario</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"All_Never_Smokers"</span>,</span>
<span>  transition_filename <span class="op">=</span> <span class="st">"NL_RF_smoking_Transitions_Netto"</span>, <span class="co"># Same as in reference scenario</span></span>
<span>  prevalence_filename <span class="op">=</span> <span class="st">"RF_smoking_cat_All_Never_Smokers_Prev"</span> <span class="co"># Different from reference scenario</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Now that we have configured a risk factor, disease, and scenario, we
write them to an XML file in a new subfolder in the
<code>Simulations</code> folder using the
<code>create_simulation_dir</code> function. The function requires the
name of the simulation and additional parameters to configure the
simulation. We will simulate the effect of the smoking intervention on
the Dutch population for 10 years starting in 2010. We will use a random
seed of 42 to ensure reproducibility.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">simulation_name</span> <span class="op">&lt;-</span> <span class="st">"Netherlands_Smoking_Intervention"</span></span>
<span></span>
<span><span class="fu"><a href="../reference/create_simulation_dir.html">create_simulation_dir</a></span><span class="op">(</span></span>
<span>  simulation_name <span class="op">=</span> <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/path.html" class="external-link">path</a></span><span class="op">(</span><span class="va">temp_dir</span>, <span class="st">"Simulations"</span>, <span class="va">simulation_name</span><span class="op">)</span>,</span>
<span>  population_name <span class="op">=</span> <span class="st">"Netherlands"</span>,</span>
<span>  has_newborns <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  starting_year <span class="op">=</span> <span class="fl">2010</span>,</span>
<span>  number_of_years <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  population_size <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  min_age <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  max_age <span class="op">=</span> <span class="fl">95</span>,</span>
<span>  time_step <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  ref_scenario_name <span class="op">=</span> <span class="st">"Netherlands_Reference_Scenario"</span>,</span>
<span>  random_seed <span class="op">=</span> <span class="fl">42</span>,</span>
<span>  scenarios <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">smoking_intervention</span><span class="op">)</span>, <span class="co"># Wrap in list because we could have multiple scenarios</span></span>
<span>  diseases <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">lung_cancer_config</span><span class="op">)</span>, <span class="co"># Wrap in list because we could have multiple diseases</span></span>
<span>  risk_factors <span class="op">=</span> <span class="va">smoking_config</span>, <span class="co"># No list because we only have one risk factor</span></span>
<span>  relative_risks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">lung_cancer_smoking_rr_config</span><span class="op">)</span> <span class="co"># Wrap in list because we could have multiple relative risks</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>The function returns <code>TRUE</code> indicating that our
configurations are valid and the subfolder was successfully created. We
can look at all the available simulations with the
<code>get_simulation_names</code> function:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_simulation_names.html">get_simulation_names</a></span><span class="op">(</span><span class="va">temp_dir</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB; font-weight: bold;">C:/Users/RUNNER~1/AppData/Local/Temp/RtmpoRI94J/file15f8b036025/Simulations</span></span></span>
<span><span class="co">#&gt; └── <span style="color: #0000BB; font-weight: bold;">Netherlands_Smoking_Intervention</span></span></span></code></pre></div>
<p>The subfolder will also contain the results from the simulation.</p>
<p>We need to add the simulation name to a batch file which we will use
as input for the DYNAMO-HIA Java application.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">batch_file_name</span> <span class="op">&lt;-</span> <span class="st">"simulation_names.txt"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/write.html" class="external-link">write</a></span><span class="op">(</span><span class="va">simulation_name</span>, <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/path.html" class="external-link">path</a></span><span class="op">(</span><span class="va">temp_dir</span>, <span class="va">batch_file_name</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="running-dynamo-hia">Running DYNAMO-HIA<a class="anchor" aria-label="anchor" href="#running-dynamo-hia"></a>
</h2>
<p>Before we can run the simulation, we need to download the DYNAMO-HIA
Java application. We can do this automatically with the
<code>download_github_release</code> function. The function will
automatically download the correct version for our operating system and
place it into our temporary directory.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/download_github_release.html">download_github_release</a></span><span class="op">(</span></span>
<span>  repo_url <span class="op">=</span> <span class="st">"https://github.com/Dynamo-HIA/dynamo-hia"</span>,</span>
<span>  release_tag <span class="op">=</span> <span class="st">"v3.0.0-beta.1"</span>,</span>
<span>  dest_dir <span class="op">=</span> <span class="va">temp_dir</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We can now run the simulation using the <code>run_dynamo_hia</code>
function. The function takes the path to the batch file and the path to
the DYNAMO-HIA executable as arguments. The latter is set automatically
by the function <code>download_github_release</code> and stored in the
environment variable <code>DYNAMO_HIA_PATH</code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_dir.html" class="external-link">with_dir</a></span><span class="op">(</span><span class="va">temp_dir</span>, <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/run_dynamo_hia.html">run_dynamo_hia</a></span><span class="op">(</span><span class="va">batch_file_name</span>, <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/path.html" class="external-link">path</a></span><span class="op">(</span><span class="va">temp_dir</span>, <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"DYNAMO_HIA_PATH"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>The function returns <code>TRUE</code> indicating that the simulation
was successful. The results of the simulation are stored in the
simulation folder.</p>
</div>
<div class="section level2">
<h2 id="loading-and-visualizing-results">Loading and visualizing results<a class="anchor" aria-label="anchor" href="#loading-and-visualizing-results"></a>
</h2>
<p>We can load the results with the <code>load_simulation_results</code>
function. The function requires the name of the simulation and the path
to the working directory. We start by loading the population results
(using <code>type = batchoutput</code>):</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_population</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_simulation_results.html">load_simulation_results</a></span><span class="op">(</span><span class="va">temp_dir</span>, <span class="va">simulation_name</span>, type <span class="op">=</span> <span class="st">"batchoutput"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get an overview of the data frame</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df_population</span><span class="op">)</span></span>
<span><span class="co">#&gt;   year scenario gender    riskClass age total.number Lung_Cancer</span></span>
<span><span class="co">#&gt; 1 2010        0      0 Never_smoker   0        99076           0</span></span>
<span><span class="co">#&gt; 2 2010        0      0 Never_smoker   1       103198           0</span></span>
<span><span class="co">#&gt; 3 2010        0      0 Never_smoker   2       103889           0</span></span>
<span><span class="co">#&gt; 4 2010        0      0 Never_smoker   3       104573           0</span></span>
<span><span class="co">#&gt; 5 2010        0      0 Never_smoker   4       106100           0</span></span>
<span><span class="co">#&gt; 6 2010        0      0 Never_smoker   5       104081           0</span></span>
<span><span class="co">#&gt;   with.disability with.disease mortality incidence.of.Lung_Cancer</span></span>
<span><span class="co">#&gt; 1        2005.416            0 499.07038                        0</span></span>
<span><span class="co">#&gt; 2        2153.652            0  36.93724                        0</span></span>
<span><span class="co">#&gt; 3        2235.289            0  28.45966                        0</span></span>
<span><span class="co">#&gt; 4        2319.714            0  21.74706                        0</span></span>
<span><span class="co">#&gt; 5        2426.453            0  14.21647                        0</span></span>
<span><span class="co">#&gt; 6        2453.870            0  14.88270                        0</span></span></code></pre></div>
<p>With the population results, we can plot the population pyramid for
the starting year of our simulation showing the difference between our
smoking intervention scenario and the reference scenario:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_population_pyramid.html">plot_population_pyramid</a></span><span class="op">(</span><span class="va">df_population</span>, year <span class="op">=</span> <span class="fl">2010</span>, scenario <span class="op">=</span> <span class="fl">1</span>, difference <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="hiaR_files/figure-html/unnamed-chunk-16-1.png" width="672"></p>
<p>We can see that disability is more prevalent in older age groups and
lung cancer only occurs in age groups above 50 and is generally a rare
disease.</p>
<p>We can also plot the prevalence of lung cancer at a specific age (75)
over time:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_prevalence.html">plot_prevalence</a></span><span class="op">(</span><span class="va">df_population</span>, disease <span class="op">=</span> <span class="st">"Lung_Cancer"</span>, age <span class="op">=</span> <span class="fl">75</span><span class="op">)</span></span></code></pre></div>
<p><img src="hiaR_files/figure-html/unnamed-chunk-17-1.png" width="672"></p>
<p>The plot shows that the prevalence of lung cancer decreases over the
years in our intervention scenario.</p>
<p>We can also compare the mortality across scenarios over time:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_mortality.html">plot_mortality</a></span><span class="op">(</span><span class="va">df_population</span>, age <span class="op">=</span> <span class="fl">75</span><span class="op">)</span></span></code></pre></div>
<p><img src="hiaR_files/figure-html/unnamed-chunk-18-1.png" width="672"></p>
<p>It seems like our intervention has a positive effect on mortality
rates in this specific age group.</p>
<p>Finally, we can plot the simulated life expectancy. This requires the
life expectancy results which we can load using
<code>type = cohortLE</code>:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_life_expectancy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_simulation_results.html">load_simulation_results</a></span><span class="op">(</span><span class="va">temp_dir</span>, <span class="va">simulation_name</span>, type <span class="op">=</span> <span class="st">"cohortLE"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get an overview of the data frame</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df_life_expectancy</span><span class="op">)</span></span>
<span><span class="co">#&gt;                         scenario gender age total.life.expectancy</span></span>
<span><span class="co">#&gt; 1 Netherlands_Reference_Scenario  males   0              77.26253</span></span>
<span><span class="co">#&gt; 2 Netherlands_Reference_Scenario  males   1              76.76924</span></span>
<span><span class="co">#&gt; 3 Netherlands_Reference_Scenario  males   2              75.64520</span></span>
<span><span class="co">#&gt; 4 Netherlands_Reference_Scenario  males   3              75.16501</span></span>
<span><span class="co">#&gt; 5 Netherlands_Reference_Scenario  males   4              73.52557</span></span>
<span><span class="co">#&gt; 6 Netherlands_Reference_Scenario  males   5              72.77295</span></span>
<span><span class="co">#&gt;   expectancy.with.disability expectancy.with.all.diseases</span></span>
<span><span class="co">#&gt; 1                   6.329091                   0.11618547</span></span>
<span><span class="co">#&gt; 2                   6.361475                   0.10652938</span></span>
<span><span class="co">#&gt; 3                   6.317164                   0.11598473</span></span>
<span><span class="co">#&gt; 4                   6.388107                   0.07567477</span></span>
<span><span class="co">#&gt; 5                   6.242434                   0.13801868</span></span>
<span><span class="co">#&gt; 6                   6.267935                   0.10949140</span></span>
<span><span class="co">#&gt;   life.expectany.with.Lung_Cancer</span></span>
<span><span class="co">#&gt; 1                      0.11618547</span></span>
<span><span class="co">#&gt; 2                      0.10652938</span></span>
<span><span class="co">#&gt; 3                      0.11598473</span></span>
<span><span class="co">#&gt; 4                      0.07567477</span></span>
<span><span class="co">#&gt; 5                      0.13801868</span></span>
<span><span class="co">#&gt; 6                      0.10949140</span></span></code></pre></div>
<p>We can now plot the life expecaancy for the different scenarios and
genders at a specific age group:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_life_expectancy.html">plot_life_expectancy</a></span><span class="op">(</span><span class="va">df_life_expectancy</span>, age <span class="op">=</span> <span class="fl">75</span><span class="op">)</span></span></code></pre></div>
<p><img src="hiaR_files/figure-html/unnamed-chunk-20-1.png" width="672"></p>
<p>We can see that our intervention increases life expectancy in this
age group.</p>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>In this example, we showed how to use the <code>hiaR</code> package
to configure and run a simulation of the DYNAMO-HIA model using the
effect of smoking on lung cancer in the Dutch population as an
example.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Hendriek Boshuizen, Malte Lüken, Flavio Hafner, Laurens Bogaardt.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
